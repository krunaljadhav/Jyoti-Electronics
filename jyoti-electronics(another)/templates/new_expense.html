{% extends "base.html" %}
{% block content %}

<style>
/* New Expense page specific */
.expense-form-wrap {
  max-width: 720px;
  margin: 12px auto;
}

.expense-card {
  padding: 22px;
  border-radius: 14px;
  background: linear-gradient(180deg, #ffffff, #fbfbff);
  box-shadow: 0 10px 30px rgba(13,38,74,0.06);
}

.form-row {
  display: flex;
  gap: 14px;
  align-items: center;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.form-row .col {
  flex: 1 1 220px;
  min-width: 160px;
}

.label-muted {
  display:block;
  font-size:0.9rem;
  color:#6b7280;
  margin-bottom:6px;
}

/* Big action area */
.actions {
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:flex-end;
  margin-top:12px;
  flex-wrap:wrap;
}

/* Secondary small note */
.hint {
  font-size:0.9rem;
  color:#6b7280;
  margin-top:10px;
}

/* Mobile adjustments */
@media (max-width:767.98px) {
  .form-row { flex-direction: column; gap:10px; }
  .actions { justify-content: stretch; }
  .actions .btn-main, .actions .btn-outline-secondary { width:100%; }
}
</style>

<div class="expense-form-wrap">
  <div class="expense-card">

    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
      <div>
        <h3 style="margin:0">Add Daily Expense</h3>
        <div class="hint">Record shop expenses quickly — parts, transport, utilities, or misc.</div>
      </div>
      <div>
        <a href="{{ url_for('expenses_list') }}" class="btn-outline-secondary"
           style="padding:8px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.05);color:#111;text-decoration:none;">
          Back to list
        </a>
      </div>
    </div>

    <form method="post" action="{{ url_for('new_expense') }}" id="new-expense-form" novalidate>
      <div class="form-row">
        <div class="col">
          <label class="form-label">Description <span style="color:#dc2626">*</span></label>
          <input type="text" name="description" id="description" class="form-control"
                 placeholder="e.g. LED parts, tape, conveyance" required
                 value="{{ request.args.get('desc','') }}">
        </div>

        <div class="col">
          <label class="form-label">Amount (₹) <span style="color:#dc2626">*</span></label>
          <input type="number" name="amount" id="amount" step="0.01" class="form-control"
                 placeholder="0.00" required value="{{ request.args.get('amount','') }}">
        </div>
      </div>

      <div class="form-row">
        <div class="col">
          <label class="form-label">Date</label>
          <input type="date" name="date" id="expense_date" class="form-control" value="">
        </div>

        <div class="col">
          <label class="form-label">Category (optional)</label>
          <!-- NOTE: category is currently not stored in DB unless you add Expense.category -->
          <select name="category" class="form-select">
            <option value="">— none —</option>
            <option value="parts">Parts</option>
            <option value="transport">Transport</option>
            <option value="rent">Rent</option>
            <option value="utilities">Utilities</option>
            <option value="misc">Misc</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div style="flex:1">
          <label class="form-label">Note (optional)</label>
          <textarea name="note" rows="2" class="form-control" placeholder="Any extra information..."></textarea>
        </div>
      </div>

      <div class="actions">
        <div style="margin-right:auto" class="hint">Fields marked <span style="color:#dc2626">*</span> are required.</div>

        <button type="reset" class="btn-outline-secondary"
                style="padding:10px 14px;border-radius:10px;border:1px solid #dbe3f3;background:#fff;">Reset</button>
        <button type="submit" class="btn-main">Save Expense</button>
      </div>
    </form>

  </div>
</div>

<script>
  // default date to today if not prefilled
  (function(){
    const dateInput = document.getElementById('expense_date');
    if (!dateInput) return;
    // server may have populated a value via queryparam; only set if empty
    if (!dateInput.value) {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const dd = String(today.getDate()).padStart(2,'0');
      dateInput.value = `${yyyy}-${mm}-${dd}`;
    }

    // Basic front-end validation to give quick feedback (server still validates)
    const form = document.getElementById('new-expense-form');
    form.addEventListener('submit', function(e){
      const desc = document.getElementById('description').value.trim();
      const amount = document.getElementById('amount').value;
      if (!desc) {
        e.preventDefault();
        alert('Please enter description for the expense.');
        document.getElementById('description').focus();
        return false;
      }
      if (!amount || parseFloat(amount) <= 0) {
        e.preventDefault();
        alert('Please enter a positive amount.');
        document.getElementById('amount').focus();
        return false;
      }
      // otherwise allow form submit
    });
  })();
</script>

{% endblock %}
