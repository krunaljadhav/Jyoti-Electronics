{% extends "base.html" %}
{% block content %}
<h4>All Works</h4>
<table class="table table-sm table-striped">
  <thead>
    <tr>
      <th>ID</th><th>Date</th><th>Customer</th><th>TV Model</th><th>Charge</th><th>Expense</th><th>Profit</th><th>Paid</th><th>Remaining</th><th>Status</th><th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for j in jobs %}
      <tr>
        <td>{{ j.id }}</td>
        <td>{{ j.created_at.strftime('%Y-%m-%d') }}</td>
        <td>{{ j.customer.name }}<br><small class="text-muted">{{ j.customer.phone }}</small></td>
        <td>{{ j.tv_model or '-' }}</td>
        <td>₹{{ '%.2f'|format(j.amount_charged or 0) }}</td>
        <td>₹{{ '%.2f'|format(j.expense or 0) }}</td>
        <td>₹{{ '%.2f'|format(j.profit) }}</td>
        <td>₹{{ '%.2f'|format(job_total_paid(j)) }}</td>
        <td>₹{{ '%.2f'|format((j.amount_charged or 0) - job_total_paid(j)) }}</td>
        <td>{{ j.status }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="{{ url_for('job_detail', job_id=j.id) }}">View</a>
          <form action="{{ url_for('delete_job', job_id=j.id) }}" method="post" style="display:inline" onsubmit="return confirm('Delete job?');">
            <button class="btn btn-sm btn-outline-danger">Del</button>
          </form>
        </td>
      </tr>
    {% else %}
      <tr><td colspan="11" class="text-muted">No jobs</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
